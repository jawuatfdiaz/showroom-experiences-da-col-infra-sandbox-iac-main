terraform_install
=================

These tasks are designed to install and configure Terraform and additionally execute the installation of the resources defined in the HCL code that has been built in the template phase. For this role to work correctly, you need to provide the required environment variables before requesting the Proof of Concept (POC) from the sandbox portal. For example:

-   `SANDBOX_ARM_CLIENT_ID`: Client ID of SP to use as authentication of az cli
-   `SANDBOX_ARM_CLIENT_SECRET` Client secret of SP to use as authentication of az cli
-   `SANDBOX_ARM_SUBSCRIPTION_ID` Subscription id to use as authentication of az cli
-   `SANDBOX_ARM_TENANT_ID` Tenant ID of SP to use as authentication of az cli
-   `PARAM_CODE`: Auth code provided by the showroom experiences microservices use to notify the events in the role
-   `NOTIFICATION_URL` URL provided by the showroom experiences microservices use to notify the events in the role
-   `POC_ID` id of the requested poc provided by the showroom experiences microservices use to notify the events in the role

If you wish to add more functionalities or implement your architecture, you can start creating tasks after the "Notify TF events" task.

tasks
-----

### Download Terraform

Downloads the Terraform zip file for version 1.5.0 from the official site and saves it in the destination directory `/tmp/terraform.zip`.

### Unzip Terraform

Unzips the previously downloaded Terraform zip file and places it in the directory `/usr/local/bin`.

### Remove zip file

Deletes the Terraform zip file after it has been extracted. Uses the `file` module and sets the state to "absent" to remove the file.

### Add Terraform to PATH

Adds the location of Terraform to the system's PATH so that Terraform can be executed globally.

### Terraform init

Uses the `terraform init` command in the GitHub repository directory where the Terraform code is located. Configures the required environment variables for authentication with Azure.

### Terraform plan

Plans and previews the changes that Terraform would make to the infrastructure based on the configuration code. Configures the necessary environment variables for authentication with Azure.

### Terraform apply

Uses the `terraform apply -auto-approve` command in the GitHub repository directory to apply the planned changes to the actual infrastructure according to the configuration code. The `terraform apply` applies the changes to the infrastructure, and `-auto-approve` is included to avoid manual confirmation. Environment variables are configured for Azure authentication.

### Terraform output

Retrieves the outputs generated by Terraform. Uses the `terraform output -json` command in the GitHub repository directory. Environment variables are configured for Azure authentication. The result is stored in the `terraform_output` variable.

### Create key-value JSON object

Converts the Terraform JSON output into a usable key-value object. Uses the `from_json` filter to parse the JSON output and stores it in the `terraform_output_json` variable.

### Notify TF events

Sends a notification through an HTTP/PUT request. This notification feeds the demo portal with information generated by the infrastructure construction. Basically, all outputs generated in Terraform are used as outputs in the events of a request so that the user can see their API URLs, portals, or whatever has been built. Uses the `uri` module to send a request to a specific URL, passing detailed information about Terraform outputs. The notification includes the date, description, and value of Terraform outputs and is triggered when the creation of the GitHub repository is successful.

Example Playbook
----------------

```yaml
- name: Create key-value JSON object
  set_fact:
    terraform_output_json: "{{ terraform_output.stdout | from_json }}"
```
Important Notes
---------------

-   Ensure that you correctly configure the variables for GitHub authentication.
-   These tasks are designed to enhance automation and collaboration in infrastructure development.
-   Run the playbook using the command: `ansible-playbook NamePlaybook.yml`.

License
-------

BSD

Author Information
------------------

@NTTDATA | Digital Technology | Digital Architecture